(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[920],{2864:function(e,t,n){Promise.resolve().then(n.bind(n,4202))},4202:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(6705),i=n(955),l=n(5806),s=n(9311);let a=i.forwardRef((e,t)=>{let{className:n,type:i,...l}=e;return(0,r.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...l})});a.displayName="Input";var u=n(3023);function o(){let{login:e,register:t}=(0,l.useAuth)(),[n,s]=(0,i.useState)(""),[o,c]=(0,i.useState)(""),[d,f]=(0,i.useState)(""),[g,h]=(0,i.useState)(!1),[m,v]=(0,i.useState)(null),[p,x]=(0,i.useState)("login"),[b,y]=(0,i.useState)(null),j=async t=>{t.preventDefault(),v(null),y(null),h(!0);try{let t=await e(n,o);t||v("Invalid credentials")}catch(e){v("Unexpected error")}finally{h(!1)}},w=async r=>{r.preventDefault(),v(null),y(null),h(!0);try{let r=await t(d,n,o);if(r.success){y("Registration successful — signing in...");let t=await e(n,o);t||v("Registration succeeded but auto-login failed")}else{var i,l;v(null!==(l=null!==(i=r.error)&&void 0!==i?i:r.message)&&void 0!==l?l:"Registration failed")}}catch(e){v("Unexpected error")}finally{h(!1)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"login"===p?"Sign in":"Register"}),(0,r.jsx)("button",{type:"button",className:"text-sm text-muted-foreground underline",onClick:()=>{x("login"===p?"register":"login"),v(null),y(null)},children:"login"===p?"Create account":"Have an account? Sign in"})]}),(0,r.jsxs)("form",{onSubmit:"login"===p?j:w,className:"flex flex-col space-y-4",children:["register"===p&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Full name"}),(0,r.jsx)(a,{name:"name",value:d,onChange:e=>f(e.target.value),placeholder:"Your name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Email"}),(0,r.jsx)(a,{type:"email",name:"email",value:n,onChange:e=>s(e.target.value),placeholder:"you@company.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Password"}),(0,r.jsx)(a,{type:"password",name:"password",value:o,onChange:e=>c(e.target.value),placeholder:"••••••••"})]}),m?(0,r.jsx)("div",{className:"text-sm text-destructive",children:m}):null,b?(0,r.jsx)("div",{className:"text-sm text-success",children:b}):null,(0,r.jsx)("div",{className:"pt-2",children:(0,r.jsx)(u.z,{type:"submit",disabled:g,children:g?"login"===p?"Signing in…":"Creating…":"login"===p?"Login":"Create account"})})]})]})}},3023:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(6705),i=n(955),l=n(4949),s=n(6061),a=n(9311);let u=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=i.forwardRef((e,t)=>{let{className:n,variant:i,size:s,asChild:o=!1,...c}=e,d=o?l.g7:"button";return(0,r.jsx)(d,{className:(0,a.cn)(u({variant:i,size:s,className:n})),ref:t,...c})});o.displayName="Button"},5806:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthProvider:function(){return s},useAuth:function(){return a}});var r=n(6705),i=n(955);let l=(0,i.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,i.useState)(null),[a,u]=(0,i.useState)(null),[o,c]=(0,i.useState)(!0),d=async()=>{try{let e=await fetch("/api/auth/session",{cache:"no-store"});if(!e.ok)return{session:null,profile:null};return await e.json()}catch(e){return{session:null,profile:null}}};(0,i.useEffect)(()=>{let e=!0,t=async()=>{let{session:t,profile:n}=await d();e&&((null==t?void 0:t.user)&&(s(t.user),u(null!=n?n:null)),c(!1))};return t(),()=>{e=!1}},[]);let f=async(e,t)=>{try{let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok)return!1;let{session:i}=await r.json();if(null==i?void 0:i.user){var n;s(i.user);let e=await d();u(null!==(n=e.profile)&&void 0!==n?n:null)}return!0}catch(e){return!1}},g=async(e,t,n)=>{try{let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})});if(!r.ok){let e=await r.json().catch(()=>({}));return{success:!1,error:null==e?void 0:e.error}}return{success:!0}}catch(e){return{success:!1,error:"Unexpected error"}}},h=async()=>{try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){}s(null),u(null)};return(0,r.jsx)(l.Provider,{value:{user:n,profile:a,loading:o,login:f,register:g,logout:h},children:t})}let a=()=>{let e=(0,i.useContext)(l);if(!e)throw Error("useAuth must be inside AuthProvider");return e}},9311:function(e,t,n){"use strict";n.d(t,{cn:function(){return l}});var r=n(7042),i=n(4769);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.m6)((0,r.W)(t))}}},function(e){e.O(0,[14,121,26,744],function(){return e(e.s=2864)}),_N_E=e.O()}]);